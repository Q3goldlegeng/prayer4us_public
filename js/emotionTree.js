/**
 * EmotionTree - 心情互動樹元件
 * @param {Array<string>} emotions - 預設情緒陣列（多語）
 * @param {Function} onSelect - 選擇情緒時的回呼 (emotionText)
 * @param {string} containerId - 要插入的 DOM id
 */
function EmotionTree({ emotions, onSelect, containerId = 'mainEmotions' }) {
  const container = document.getElementById(containerId);
  container.innerHTML = '';
  container.style.position = 'relative';

  

  // 樹幹與分枝座標
  const width = 400, height = 380, centerX = 180, trunkY = 200;
  const branchCoords = [
    { x: centerX + 5, y: trunkY - 110 },   // 焦慮
    { x: centerX - 50, y: trunkY - 30 },  // 悲傷
    { x: centerX + 90, y: trunkY - 60 },  // 孤獨
    { x: centerX + 80, y: trunkY - 100 },   // 壓力
    { x: centerX + 70, y: trunkY + 10 },   // 喜樂
    { x: centerX, y: trunkY + 60 }         // 自訂
  ];
  // 每個按鈕的偏移與方向
  const labelOffsets = [
    { dx: -70, dy: -50 },   // 焦慮
    { dx: -90, dy: 0 },  // 悲傷
    { dx: 90, dy: 0 },     // 孤獨
    { dx: 80, dy: -30 },   // 壓力
    { dx: 80, dy: 20 },    // 喜樂
    { dx: 0, dy: 30 }      // 自訂
  ];

  // 建立SVG
  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
  svg.setAttribute('width', '100%');
  svg.setAttribute('height', '340');
  svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
  svg.setAttribute('style', 'max-width:420px;display:block;margin:auto;position:relative;z-index:1;');

  // 畫樹幹與分枝（可自訂SVG內容）
  svg.innerHTML = `
    <g transform="scale(0.6) translate(100,110)">
      <path d="M68.498,550.001c0.279,0.251,0.64,0.386,1.016,0.386h415.383c0.446,0,0.869-0.192,1.159-0.532
			c0.267-0.312,6.494-7.715,2.154-17.543c-7.665-17.365-47.519-38.93-193.395-43.388c2.992-4.076,6.016-8.137,9.036-12.188
			c20.214-27.114,36.423-54.776,49.554-84.565c11.766-26.699,23.978-57.841,19.93-89.604c-3.947-30.955-19.97-60.646-35.459-89.346
			c-1.157-2.191-2.524-4.562-3.966-7.053c-7.788-13.47-17.482-30.233-6.295-41.521c0.578-0.582,0.594-1.518,0.034-2.118
			c-0.558-0.603-1.49-0.652-2.115-0.123c-14.602,12.509-6.967,29.141-1.392,41.286c2.613,5.682,5.294,11.359,7.978,17.032
			c5.101,10.793,10.379,21.95,15.046,32.975c12.76,30.162,13.451,62.105,2.09,97.528c-8.645-25.01-33.274-46.809-57.137-67.929
			c-4.314-3.819-8.62-7.629-12.824-11.45c-30.842-28.021-43.366-57.789-38.293-91.005c4.416-28.936,24.609-54.581,45.982-81.732
			c3.14-3.987,6.282-7.98,9.376-11.989c9.945-12.867,21.285-31.861,18.835-49.257c-1.225-8.7-5.836-16.034-13.7-21.806
			c-0.651-0.477-1.561-0.364-2.077,0.254c-0.518,0.618-0.466,1.533,0.119,2.09c6.536,6.227,9.73,13.164,9.765,21.212
			c0.101,22.222-24.78,47.714-43.275,65.735c13.602-35.414,24.03-67.85,20.649-101.458c-0.079-0.808-0.771-1.398-1.598-1.374
			c-0.813,0.042-1.453,0.713-1.453,1.53c0,32.552-15.578,64.71-30.646,95.812c-15.998,33.023-32.5,67.09-30.695,102.127
			c-1.346-2.895-2.65-5.856-3.993-8.908c-10.229-23.256-20.808-47.304-59.288-61.402c-0.765-0.281-1.622,0.092-1.937,0.845
			c-0.315,0.756,0.019,1.625,0.762,1.974c35.766,16.854,43.348,40.523,51.377,65.582c3.957,12.353,8.048,25.125,15.848,36.698
			c10.964,16.27,28.011,31.387,44.498,46.007c23.051,20.441,46.886,41.577,53.596,65.631c10.594,37.987-16.08,75.01-41.876,110.812
			l-5,6.955c-5.896,8.229-10.814,15.138-15.587,22.313c-120.677,0.575-189.457,14.104-198.912,39.138
			C57.186,539.756,68.033,549.588,68.498,550.001z"/>
		<path d="M347.105,111.164c-12.77,10.591-17.488,28.749-13.847,44.682c4.079-8.785,10.318-17.053,17.815-23.176
			c11.264-9.202,24.395-16.062,33.92-27.314c6.635-7.836,10.301-18.614,12.338-28.568c-4.617,8.048-13.002,13.333-21.028,17.423
			C366.218,99.349,355.887,103.881,347.105,111.164z"/>
		<path d="M393.094,96.43c-6.849,17.616-24.902,25.787-38.508,37.259c-17.071,14.394-19.948,33.412-19.948,33.412
			c1.228-1.641,2.547-3.231,3.96-4.716c2.338-2.454,5.275-3.825,8.329-5.15c3.269-1.417,6.659-2.543,10.004-3.761
			c3.319-1.208,6.634-2.485,9.755-4.152c12.025-6.417,21.325-15.716,24.728-29.162C393.351,112.516,393.92,104.282,393.094,96.43z"
			/>
		<path d="M122.535,158.355c-9.676,0.04-19.749-2.375-28.485-6.561c7.319,14.611,22.509,25.627,39.098,25.683
			c11.411,0.037,22.265-3.036,33.314-5.48c8.798-1.946,18.626-3.201,27.308,0.076c-7.904-6.386-17.586-12.375-27.69-14.205
			C151.577,155.24,137.079,158.297,122.535,158.355z"/>
		<path d="M178.013,159.606c-4.354-6.585-10.031-12.577-16.386-17.246c-11.178-8.213-24.269-9.48-37.629-6.784
			c-3.47,0.701-6.839,1.821-10.171,2.999c-3.357,1.187-6.689,2.472-10.113,3.458c-3.198,0.921-6.337,1.729-9.704,1.322
			c-2.035-0.248-4.063-0.636-6.053-1.123c0,0,14.315,12.852,36.641,13.106C142.394,155.537,161.525,150.365,178.013,159.606z"/>
		<path d="M226.565,82.029c6.429,6.31,12.843,13.865,14.835,22.929c1.041-10.107,0.777-21.487-3.201-30.955
			c-5.713-13.589-16.181-24.073-24.165-36.23c-5.315-8.087-8.785-17.849-10.042-27.451c-8.253,14.106-9.195,32.846-0.193,46.778
			C209.993,66.68,218.487,74.101,226.565,82.029z"/>
		<path d="M243.252,84.949c3.143-7.243,5.067-15.27,5.514-23.14c0.786-13.849-5.297-25.511-14.844-35.236
			c-2.479-2.527-5.257-4.74-8.063-6.888c-2.828-2.164-5.722-4.257-8.415-6.588c-2.516-2.179-4.908-4.367-6.398-7.411
			c-0.903-1.839-1.683-3.752-2.362-5.686c0,0-2.959,19.005,9.008,37.858C227.229,52.88,242,66.09,243.252,84.949z"/>
		<path d="M195.718,298.598c-10.582,2.959-22.338,3.348-33.161,1.396c12.411,13.794,32.359,21.279,50.536,16.344
			c12.503-3.394,23.461-10.024,34.823-16.031c9.045-4.78,19.428-9.113,29.92-8.137c-10.575-4.614-22.977-8.253-34.59-7.216
			C226.575,286.446,211.621,294.154,195.718,298.598z"/>
		<path d="M190.46,273.218c-3.589,1.812-6.94,4.052-10.232,6.347c-3.317,2.311-6.579,4.722-10.031,6.83
			c-3.225,1.971-6.417,3.801-10.224,4.366c-2.301,0.343-4.639,0.526-6.964,0.594c0,0,19.541,9.759,44.061,3.314
			c19.541-5.135,38.929-16.558,59.759-11.405c-6.75-5.896-14.771-10.749-23.131-13.947
			C218.989,263.689,204.276,266.244,190.46,273.218z"/>
		<path d="M282.97,228.417c3.009,10.034,11.384,18.663,21.852,20.53c7.2,1.282,14.392,0.542,21.641,0.217
			c5.768-0.257,12.114,0.034,17.233,3.063c-4.283-4.905-9.736-9.752-15.915-12.023c-8.867-3.259-18.359-2.931-27.549-4.498
			C294.118,234.662,288.026,232.024,282.97,228.417z"/>
		<path d="M303.668,221.483c-2.268,0.058-4.52,0.395-6.754,0.771c-2.249,0.379-4.495,0.823-6.766,1.068
			c-2.12,0.227-4.191,0.392-6.27-0.236c-1.258-0.379-2.494-0.851-3.696-1.377c0,0,7.619,9.694,21.689,12.316
			c11.211,2.09,23.861,0.937,33.25,8.59c-2.023-4.639-4.945-9.049-8.443-12.696C320.529,223.499,312.402,221.256,303.668,221.483z"
			/>
		<path d="M364.437,46.038c6.178-2.271,11.628-7.118,15.915-12.023c-5.119,3.026-11.466,3.32-17.234,3.063
			c-7.249-0.325-14.439-1.065-21.64,0.217c-10.469,1.867-18.841,10.496-21.852,20.53c5.052-3.608,11.147-6.243,17.262-7.286
			C346.08,48.969,355.569,49.296,364.437,46.038z"/>
		<path d="M326.808,62.919c2.271,0.245,4.517,0.688,6.766,1.068c2.233,0.376,4.483,0.713,6.754,0.771
			c8.732,0.227,16.857-2.017,23.008-8.437c3.497-3.647,6.417-8.06,8.442-12.696c-9.388,7.653-22.038,6.5-33.25,8.589
			c-14.069,2.625-21.689,12.316-21.689,12.316c1.203-0.526,2.442-0.998,3.696-1.377C322.616,62.525,324.688,62.69,326.808,62.919z"
			/>
		<path d="M308.766,156.274c-5.119,3.026-11.463,3.32-17.233,3.063c-7.249-0.324-14.44-1.064-21.641,0.217
			c-10.468,1.867-18.84,10.496-21.852,20.53c5.052-3.608,11.147-6.242,17.262-7.286c9.189-1.566,18.678-1.239,27.549-4.498
			C299.03,166.026,304.482,161.179,308.766,156.274z"/>
		<path d="M245.253,186.792c1.203-0.526,2.442-0.998,3.697-1.377c2.078-0.63,4.149-0.465,6.27-0.236
			c2.271,0.245,4.517,0.688,6.766,1.068c2.234,0.376,4.483,0.713,6.754,0.771c8.733,0.226,16.857-2.017,23.008-8.437
			c3.498-3.647,6.417-8.057,8.442-12.696c-9.388,7.653-22.038,6.499-33.25,8.589C252.873,177.098,245.253,186.792,245.253,186.792z"
			/>
		<path d="M381.466,303.301c4.051-4.703,9.342-8.715,15.033-11.181c8.553-3.709,17.849-5.646,25.688-10.922
			c5.459-3.675,9.603-9.679,12.599-15.462c-4.254,4.158-10.346,5.952-16.01,7.071c-7.118,1.408-14.278,2.399-20.968,5.355
			C388.084,282.466,382.001,292.839,381.466,303.301z"/>
		<path d="M398.489,293.362c-13.042,5.894-18.137,17.12-18.137,17.12c1.043-0.795,2.133-1.548,3.265-2.215
			c1.87-1.104,3.92-1.438,6.034-1.72c2.265-0.303,4.551-0.407,6.827-0.572c2.259-0.165,4.526-0.373,6.741-0.857
			c8.537-1.857,15.894-5.967,20.343-13.665c2.527-4.376,4.318-9.354,5.181-14.34C421.442,286.777,408.88,288.662,398.489,293.362z"
			/>
  `;

  
  

  // 畫連結線（樹葉→按鈕）
  branchCoords.forEach(({ x, y }, idx) => {
    const { dx, dy } = labelOffsets[idx];
    const btnX = x + dx;
    const btnY = y + dy + 20; // +20 讓線連到按鈕中間（依按鈕高度微調）
    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    line.setAttribute('x1', x);
    line.setAttribute('y1', y);
    line.setAttribute('x2', btnX);
    line.setAttribute('y2', btnY);
    line.setAttribute('stroke', '#3399ff');
    line.setAttribute('stroke-width', '2');
    svg.appendChild(line);
  });

  // 插入SVG
  container.appendChild(svg);

  // 建立 emotionLabels 容器（用於浮動按鈕）
  let emotionLabels = document.getElementById('emotionLabels');
  if (!emotionLabels) {
    emotionLabels = document.createElement('div');
    emotionLabels.id = 'emotionLabels';
    emotionLabels.style.position = 'absolute';
    emotionLabels.style.top = '0';
    emotionLabels.style.left = '0';
    emotionLabels.style.width = '100%';
    emotionLabels.style.height = '100%';
    emotionLabels.style.pointerEvents = 'none';
    emotionLabels.style.zIndex = 2;
    container.appendChild(emotionLabels);
  } else {
    emotionLabels.innerHTML = '';
  }

  // 產生按鈕並定位到樹葉旁
  function renderEmotionButtons() {
    emotionLabels.innerHTML = emotions.map((emotion, idx) => {
      const { x, y } = branchCoords[idx];
      const { dx, dy } = labelOffsets[idx];
      return `<button class="emotion-float-btn"
        style="
          position:absolute;
          left:calc(50% + ${x + dx - width/2}px);
          top:${y + dy}px;
          transform:translate(-50%,0);
          pointer-events:auto;
          z-index:10;
          background:#fff;
          border:2px solid #3399ff;
          color:#3399ff;
          font-weight:bold;
          transition:background 0.2s, color 0.2s;
        "
        data-idx="${idx}"
      >${emotion}</button>`;
    }).join('');
    // 綁定按鈕點擊事件
    emotionLabels.querySelectorAll('.emotion-float-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const idx = Number(btn.dataset.idx);
        // 高亮顯示被點擊的按鈕，其他恢復原色
        emotionLabels.querySelectorAll('.emotion-float-btn').forEach((b, i) => {
          if (i === idx) {
            b.style.background = '#3399ff';
            b.style.color = '#fff';
          } else {
            b.style.background = '#fff';
            b.style.color = '#3399ff';
          }
        });
        if (onSelect) onSelect(emotions[idx]);
        showDove(branchCoords[idx].x, branchCoords[idx].y);
      });
    });
  }
  renderEmotionButtons();

  // 響應式：視窗縮放時重繪按鈕位置
  window.addEventListener('resize', renderEmotionButtons);

  // 白鴿動畫
  let doveEl = null;
  let doveX = null, doveY = null;
  function showDove(x, y) {
    // 播放鴿子音效
    try {
      const doveAudio = new Audio('assets/dove.mp3');
      doveAudio.volume = 0.7;
      doveAudio.play();
    } catch (e) { console.warn('dove 音效播放失敗', e); }
    // 如果已經有 dove，做動畫移動
    if (!doveEl) {
      doveEl = document.createElementNS('http://www.w3.org/2000/svg', 'g');
      doveEl.setAttribute('id', 'dove-anim');
      doveEl.innerHTML = `
        <path style="fill:#BEC0C2;" d="M264.108,261.97c0.544-0.389,1.077-0.793,1.593-1.219c3.49-2.881,6.005-6.522,6.75-11.041v0
        c0.02-0.123,0.017-0.232,0.005-0.335c-0.004-0.03-0.01-0.058-0.016-0.087c-0.016-0.074-0.04-0.142-0.071-0.205
        c-0.011-0.023-0.02-0.046-0.033-0.068c-0.045-0.074-0.1-0.141-0.164-0.201c-0.024-0.023-0.053-0.041-0.079-0.061
        c-0.044-0.034-0.09-0.066-0.14-0.094c-0.04-0.023-0.08-0.045-0.123-0.064c-0.038-0.017-0.078-0.032-0.118-0.047
        c-0.119-0.044-0.242-0.079-0.37-0.101c-0.002,0-0.004-0.001-0.006-0.001h0c-0.247-0.043-0.499-0.052-0.719-0.029
        c-6.545,0.684-12.875,3.153-19.085,5.457c1.51-0.821,2.99-1.68,4.415-2.587c3.007-1.913,5.838-4.153,8.242-6.751
        c0.044-0.047,0.088-0.094,0.132-0.142c0.492-0.538,0.966-1.091,1.419-1.661c0.047-0.06,0.093-0.12,0.14-0.18
        c0.893-1.141,1.701-2.346,2.407-3.615c0.059-0.105,0.118-0.209,0.175-0.316c0.326-0.605,0.629-1.225,0.906-1.86
        c0.051-0.116,0.097-0.233,0.146-0.35c0.278-0.663,0.537-1.338,0.758-2.034c0.605-1.906,1.215-4.184,1.268-6.39
        c0.041-1.715-0.254-3.386-1.151-4.803c0,0,0,0-0.001-0.001c-0.091-0.143-0.21-0.248-0.34-0.337
        c-0.036-0.025-0.075-0.044-0.114-0.064c-0.11-0.059-0.227-0.104-0.352-0.133c-0.033-0.007-0.063-0.018-0.097-0.024
        c-0.344-0.06-0.719-0.026-1.072,0.071c0,0-0.001,0-0.001,0l0,0c-0.354,0.097-0.683,0.249-0.916,0.434
        c-17.613,13.952-38.198,22.965-60.084,27.569c0,0,0,0,0,0c-0.389,0.082-0.775,0.173-1.164,0.252
        c0.105-0.087,0.205-0.181,0.309-0.269c0.33-0.151,0.657-0.295,0.99-0.45c0,0-0.279,0.094-0.755,0.245
        c2.805-2.439,5.089-5.457,5.52-9.171v0l0,0c0.001-0.01-0.002-0.021-0.001-0.031c0.033-0.398-0.179-0.859-0.512-1.077
        c-1.368-0.897-2.943-1.348-4.603-1.534l0,0c-0.274-0.031-0.546-0.071-0.824-0.087c2.811-1.501,5.568-3.099,8.218-4.859
        c2.88-1.913,5.758-4.041,8.057-6.644c1.739-1.969,3.483-4.509,3.293-7.267l0,0v0c-0.015-0.221-0.074-0.404-0.151-0.568
        c-0.022-0.051-0.042-0.103-0.07-0.148c-0.071-0.112-0.158-0.206-0.257-0.287c-0.077-0.066-0.159-0.121-0.251-0.167c0,0,0,0,0,0v0
        c-0.312-0.156-0.69-0.219-1.13-0.139c-3.309,0.598-6.543,1.47-9.738,2.477c0,0,0,0,0,0c-0.758,0.239-1.515,0.479-2.268,0.732
        c2.55-1.793,5.047-3.661,7.476-5.622c5.969-4.819,11.716-9.989,16.633-15.896c5.504-6.614,10.238-14.297,11.611-22.92l0,0l0,0
        c0.026-0.162,0.019-0.299-0.002-0.426c-0.006-0.037-0.016-0.07-0.026-0.105c-0.024-0.088-0.059-0.167-0.104-0.238
        c-0.016-0.026-0.03-0.053-0.049-0.077c-0.067-0.083-0.144-0.155-0.236-0.212c-0.025-0.016-0.055-0.026-0.081-0.04
        c-0.072-0.038-0.147-0.07-0.229-0.096c-0.048-0.015-0.096-0.028-0.146-0.039c-0.066-0.015-0.133-0.026-0.202-0.034
        c-0.057-0.007-0.111-0.017-0.169-0.02c-0.104-0.006-0.209-0.007-0.313-0.002v0c-0.3,0.014-0.591,0.066-0.817,0.141
        c-7.568,2.53-12.638,9.663-18.709,14.439c-0.625,0.491-1.24,0.993-1.856,1.496c1.33-1.339,2.629-2.709,3.913-4.093
        c0.04-0.043,0.079-0.087,0.119-0.13c0.875-0.946,1.742-1.899,2.593-2.867c0.248-0.281,0.487-0.568,0.733-0.851
        c0.654-0.755,1.31-1.508,1.949-2.277c0.896-1.076,1.778-2.165,2.642-3.27c0.011-0.014,0.022-0.027,0.033-0.041
        c4.196-5.369,8.149-10.996,11.333-17.031c2.428-4.601,4.725-9.274,6.924-13.989c2.567-5.505,5.053-11.095,6.944-16.873
        c0.742-2.265,1.422-4.603,1.711-6.975c0.068-0.557,0.118-1.167,0.102-1.778c-0.026-1.019-0.233-2.04-0.844-2.82
        c-0.161-0.206-0.331-0.374-0.505-0.523c-0.03-0.026-0.06-0.054-0.091-0.078c-0.167-0.133-0.34-0.242-0.517-0.328
        c-0.036-0.018-0.073-0.033-0.109-0.048c-0.181-0.078-0.364-0.14-0.552-0.176c-0.021-0.004-0.042-0.004-0.063-0.007
        c-0.174-0.028-0.35-0.037-0.529-0.033c-0.043,0.001-0.086-0.001-0.129,0.002c-0.18,0.012-0.362,0.041-0.545,0.081
        c-0.063,0.014-0.125,0.03-0.188,0.047c-0.174,0.047-0.349,0.102-0.525,0.171c-0.073,0.029-0.146,0.064-0.22,0.096
        c-0.118,0.052-0.235,0.107-0.353,0.168c-0.135,0.069-0.268,0.142-0.403,0.22c-0.097,0.057-0.194,0.114-0.291,0.175
        c-0.116,0.073-0.231,0.149-0.346,0.228c-0.025,0.017-0.049,0.036-0.074,0.053c-0.245,0.171-0.486,0.352-0.723,0.543
        c-0.001,0.001-0.002,0.002-0.003,0.003l0,0c-1.426,1.146-2.689,2.566-3.434,3.402c-2.566,2.882-4.927,5.953-7.212,9.077
        c0,0,0,0,0,0c-0.001,0.001-0.001,0.002-0.002,0.002c-1.382,1.889-2.742,3.792-4.083,5.698c-0.001,0.002-0.003,0.004-0.005,0.007
        c-0.468,0.665-0.92,1.341-1.382,2.011c4.15-9.353,7.441-19.101,9.892-29.031c1.858-7.528,3.727-15.118,4.969-22.774
        c0.376-2.319,0.702-4.666,0.897-7.022c0.195-2.356,0.259-4.72,0.111-7.072c-0.239-3.809-0.925-7.907-3.43-10.939
        c-0.949-1.148-2.804-0.59-3.665,0.386c-0.38,0.43-0.729,0.88-1.068,1.336c-3.17,4.193-4.872,9.295-6.998,14.065
        c-2.863,6.422-5.625,12.888-8.399,19.348c-1.62,3.774-3.271,7.535-4.954,11.28c0.164-0.538,0.313-1.081,0.473-1.62c0,0,0,0,0,0
        c0-0.001,0.001-0.002,0.001-0.003c0.409-1.377,0.809-2.756,1.19-4.141c0.407-1.469,0.799-2.942,1.166-4.422
        c0.002-0.008,0.004-0.017,0.007-0.025c1.868-7.528,3.052-15.119,4.107-22.774c0.151-1.094,0.299-2.188,0.446-3.285
        c0.875-6.513,1.676-13.067,1.685-19.648c0.008-5.725-0.098-14.385-5.472-18c-0.141-0.095-0.288-0.156-0.438-0.202
        c-0.045-0.014-0.09-0.022-0.135-0.031c-0.112-0.024-0.224-0.037-0.337-0.038c-0.046,0-0.091-0.003-0.137,0
        c-0.148,0.009-0.296,0.031-0.443,0.073c-0.005,0.001-0.01,0.001-0.016,0.003c-0.151,0.044-0.299,0.108-0.443,0.181
        c-0.045,0.023-0.088,0.049-0.133,0.074c-0.102,0.058-0.199,0.121-0.294,0.191c-0.043,0.031-0.085,0.061-0.126,0.094
        c-0.115,0.093-0.225,0.193-0.326,0.299c-0.011,0.011-0.023,0.021-0.033,0.032c0,0,0,0,0,0l0,0
        c-0.242,0.263-0.433,0.557-0.548,0.852c-3.191,8.238-2.708,17.222-4.608,25.741c-1.664,7.46-3.454,14.901-5.513,22.264
        c1.605-13.135,1.535-26.522,0.257-39.679c-0.661-6.814-1.736-13.595-3.379-20.244c-0.981-3.972-1.933-8.476-4.075-12.023
        c-0.821-1.359-2.035-2.56-3.716-2.586c-2.285-0.034-4.373,1.99-5.195,3.983c-0.851,2.066-0.72,4.501-0.679,6.688
        c0.052,2.764-0.181,5.513-0.324,8.273c-0.28,5.424-0.698,10.851-1.215,16.271c-0.645,2.613-0.773,5.446-0.854,8.17
        c-0.532,4.652-1.131,9.294-1.787,13.918c-3.505,24.701-9.571,49.404-21.535,71.469c-5.783,10.666-12.857,20.749-20.572,30.104
        c-2.677,3.245-5.458,6.392-8.355,9.42c-7.25,6.485-15.517,12.051-24.681,15.071c-3.732,1.23-7.634,1.938-11.539,1.983
        c-3.222-0.731-6.367-1.814-9.303-3.25c-2.257-1.904-4.121-4.301-5.64-6.876c-2.947-4.993-4.812-10.527-6.989-15.875
        c-2.478-6.087-5.761-11.983-10.584-16.531c-5.806-5.475-13.415-6.735-21.122-5.81c-7.827,0.939-14.815,4.48-20.271,10.15
        c-4.132,4.294-7.219,9.64-8.483,15.467c-2.311,0.319-4.569,0.981-6.687,1.992c-5.059,2.416-9.104,6.364-11.942,11.167
        c-1.235,2.09-2.325,4.438-2.978,6.874c0.762-0.36,1.575-0.622,2.32-0.823c0.159-0.043,0.322-0.075,0.482-0.115
        c3.533-0.879,7.273-1.024,10.911-1.03c0.301,0,0.603-0.002,0.902-0.001c3.572,0.013,7.278,1.815,10.82,1.947
        c0.297,0.446,0.585,0.898,0.909,1.326c2.321,3.067,5.495,5.317,7.602,8.557c2.04,3.136,3.156,6.726,3.885,10.37
        c1.516,7.586,1.871,15.393,3.076,23.034c1.117,7.076,2.781,14.076,5.763,20.616c6.391,14.017,18.768,24.557,32.065,31.862
        c13.461,7.395,28.416,11.635,43.615,13.49c16.047,1.959,32.058,0.917,47.944-1.834c9.248-1.602,18.467-3.549,27.823-4.425
        c7.12-0.667,14.314-0.81,21.324,0.773c10.861,2.453,22.672,8.826,25.365,20.541c0.684,2.976,0.739,6.163,0.26,9.177
        c-0.099,0.623,0.246,1.031,0.721,1.254c0.455,0.666,1.476,0.848,2.431,0.446c1.302-0.549,2.392-1.342,3.324-2.285
        c0.009-0.009,0.018-0.018,0.027-0.027c0.319-0.325,0.618-0.668,0.897-1.031c0.004-0.005,0.008-0.011,0.012-0.016
        c1.934-2.529,2.895-5.892,3.097-9.333c0.006-0.103,0.016-0.205,0.02-0.309c0.017-0.366,0.021-0.731,0.021-1.097
        c0-0.177,0.001-0.354-0.002-0.531c-0.007-0.322-0.021-0.641-0.04-0.96c-0.013-0.222-0.028-0.442-0.047-0.663
        c-0.025-0.285-0.052-0.568-0.087-0.85c-0.031-0.254-0.067-0.504-0.104-0.754c-0.038-0.251-0.076-0.5-0.122-0.747
        c-0.051-0.279-0.111-0.55-0.171-0.823c-0.047-0.214-0.092-0.43-0.145-0.639c-0.078-0.311-0.168-0.612-0.258-0.912
        c-0.049-0.162-0.092-0.33-0.144-0.488c-0.149-0.454-0.309-0.895-0.484-1.316c-1.09-2.626-2.786-4.965-4.676-7.109
        c3.768,1.197,8.566,2.859,11.803,0.267c0.636-0.509,1.131-1.164,1.117-1.91c-0.005-0.248-0.066-0.507-0.197-0.774
        c-0.108-0.219-0.243-0.425-0.372-0.634l0,0c-1.46-2.371-4.169-4.094-6.456-5.486c-2.173-1.322-4.445-2.503-6.759-3.593
        c1.828-0.494,3.538-1.17,5.194-2.007c0.553-0.278,1.103-0.569,1.646-0.886c0.133-0.078,0.264-0.163,0.396-0.244
        c0.644-0.39,1.284-0.803,1.919-1.254c0.001-0.001,0.002-0.001,0.003-0.002c3.18-2.26,7.818-5.952,7.598-10.336l0,0l0,0
        c-0.01-0.199-0.056-0.38-0.088-0.568c-0.423-2.507-2.679-4.03-4.968-4.852c-2.361-0.848-4.934-1.169-7.474-1.302
        c1.702-0.834,3.334-1.784,4.863-2.873C264.083,261.986,264.096,261.978,264.108,261.97z"/>
    <g>
        <path style="fill:#F3F4F4;" d="M270.089,244.2c0.18-1.094-1.043-1.375-1.834-1.293c-6.546,0.684-12.875,3.153-19.086,5.457
            c1.51-0.821,2.99-1.68,4.415-2.587c6.378-4.058,11.994-9.565,14.326-16.908c1.076-3.387,2.166-7.955,0.117-11.193
            c-0.595-0.94-2.178-0.618-2.892-0.052c-17.926,14.2-38.927,23.295-61.248,27.821c3.054-2.516,5.604-5.69,6.064-9.645
            c0.047-0.405-0.172-0.885-0.513-1.108c-1.594-1.045-3.462-1.509-5.427-1.621c2.811-1.501,5.569-3.1,8.218-4.859
            c2.88-1.913,5.757-4.041,8.057-6.644c1.739-1.969,3.484-4.509,3.293-7.267c-0.072-1.038-0.844-1.493-1.858-1.31
            c-4.093,0.74-8.076,1.888-12.006,3.209c2.55-1.793,5.047-3.661,7.476-5.622c5.969-4.819,11.716-9.989,16.633-15.896
            c5.504-6.614,10.238-14.297,11.61-22.92c0.228-1.432-1.527-1.43-2.374-1.147c-7.568,2.53-12.638,9.663-18.709,14.439
            c-0.624,0.491-1.24,0.993-1.856,1.496c4.242-4.271,8.261-8.766,11.983-13.529c4.196-5.369,8.149-10.996,11.333-17.031
            c2.428-4.601,4.725-9.274,6.924-13.989c2.567-5.505,5.053-11.095,6.944-16.873c0.741-2.265,1.422-4.603,1.711-6.975
            c0.181-1.484,0.235-3.35-0.741-4.598c-2.848-3.638-7.774,1.945-9.597,3.993c-4.12,4.627-7.739,9.724-11.302,14.784
            c-0.468,0.665-0.92,1.341-1.382,2.011c4.15-9.353,7.441-19.101,9.892-29.032c1.858-7.528,3.727-15.118,4.969-22.775
            c0.752-4.638,1.304-9.39,1.008-14.094c-0.239-3.809-0.925-7.907-3.43-10.939c-0.949-1.149-2.804-0.59-3.665,0.385
            c-3.893,4.41-5.71,10.115-8.066,15.401c-2.863,6.422-5.625,12.888-8.399,19.348c-1.621,3.774-3.271,7.535-4.954,11.28
            c1.03-3.379,1.985-6.78,2.837-10.21c2.135-8.603,3.376-17.29,4.554-26.059c0.875-6.513,1.676-13.067,1.685-19.648
            c0.008-5.725-0.098-14.385-5.472-18c-1.243-0.836-2.948,0.34-3.407,1.527c-3.191,8.238-2.708,17.222-4.608,25.741
            c-1.664,7.46-3.454,14.901-5.513,22.265c1.605-13.135,1.535-26.522,0.257-39.679c-0.661-6.814-1.736-13.596-3.379-20.244
            c-0.981-3.972-1.933-8.476-4.075-12.023c-0.821-1.36-2.035-2.56-3.716-2.586c-2.285-0.035-4.373,1.99-5.195,3.983
            c-0.851,2.066-0.72,4.501-0.679,6.688c0.052,2.764-0.181,5.513-0.324,8.273c-0.281,5.424-0.698,10.851-1.215,16.271
            c-0.645,2.613-0.772,5.446-0.854,8.171c-0.532,4.652-1.131,9.294-1.787,13.918c-3.505,24.701-9.572,49.404-21.535,71.469
            c-5.783,10.666-12.856,20.749-20.572,30.104c-2.676,3.245-5.458,6.392-8.355,9.42c-7.249,6.485-15.517,12.051-24.681,15.071
            c-3.732,1.23-7.634,1.938-11.54,1.983c-3.222-0.731-6.366-1.814-9.303-3.25c-2.257-1.904-4.121-4.301-5.641-6.876
            c-2.947-4.993-4.812-10.527-6.989-15.875c-2.478-6.087-5.761-11.983-10.584-16.531c-5.806-5.475-13.414-6.735-21.122-5.81
            c-7.827,0.939-14.815,4.48-20.271,10.15c-4.741,4.926-8.11,11.238-8.924,18.072c-0.792,6.652,1.146,13.406,5.179,18.734
            c2.322,3.067,5.495,5.317,7.602,8.557c2.04,3.136,3.156,6.726,3.884,10.37c1.516,7.586,1.871,15.393,3.076,23.034
            c1.116,7.077,2.781,14.076,5.763,20.616c6.391,14.016,18.768,24.557,32.065,31.862c13.461,7.395,28.416,11.635,43.615,13.49
            c16.047,1.959,32.058,0.917,47.944-1.835c9.248-1.602,18.467-3.549,27.823-4.425c7.12-0.667,14.314-0.81,21.324,0.773
            c10.861,2.453,22.672,8.826,25.365,20.541c0.684,2.976,0.739,6.163,0.26,9.177c-0.099,0.623,0.246,1.031,0.721,1.254
            c0.455,0.666,1.476,0.848,2.431,0.446c8.141-3.429,8.738-15.69,5.794-22.782c-1.09-2.626-2.786-4.965-4.676-7.109
            c3.768,1.198,8.566,2.859,11.803,0.267c0.848-0.679,1.444-1.617,0.919-2.684c-1.332-2.709-4.339-4.605-6.828-6.12
            c-2.173-1.323-4.445-2.503-6.759-3.593c3.316-0.896,6.258-2.332,9.158-4.394c3.18-2.261,7.818-5.952,7.598-10.336
            c-0.143-2.857-2.595-4.536-5.056-5.42c-2.361-0.848-4.934-1.169-7.474-1.302c2.322-1.137,4.517-2.486,6.493-4.117
            C266.83,252.36,269.345,248.719,270.089,244.2z"/>
        <path style="fill:#DEDFE0;" d="M249.945,63.625c1.352,2.515,1.564,5.55,1.511,8.35c-0.064,3.343-0.57,6.675-1.191,9.955
            c-0.528,2.786-1.187,5.542-1.772,8.315c-0.907,4.296-1.812,8.581-2.914,12.833c-2.391,9.222-5.396,18.273-8.778,27.177
            c-2.753,7.249-5.75,14.401-8.822,21.52c1.05-1.481,2.091-2.969,3.119-4.467c3.956-5.764,7.741-11.656,11.152-17.761
            c0.541-0.967,1.068-1.942,1.59-2.922c-1.384,1.892-2.746,3.799-4.09,5.707c-0.468,0.665-0.92,1.341-1.382,2.011
            c4.15-9.353,7.441-19.101,9.892-29.032c1.858-7.528,3.727-15.118,4.969-22.774c0.752-4.638,1.304-9.39,1.008-14.094
            c-0.239-3.809-0.925-7.907-3.43-10.939c-0.949-1.149-2.804-0.59-3.665,0.386c-0.633,0.717-1.195,1.479-1.73,2.257
            C247.318,60.392,249.021,61.906,249.945,63.625z"/>
        <path style="fill:#DEDFE0;" d="M266.674,218.954c0.134,2.282-1.306,4.577-2.561,6.365c-1.409,2.006-3.097,3.795-4.757,5.59
            c-2.407,2.602-5.054,4.97-7.86,7.133c-10.767,8.302-23.533,13.399-36.183,18.132c3.294,0.171,6.612-0.117,9.858-0.662
            c8.453-1.422,16.654-4.421,24.357-8.129c2.389-1.15,4.76-2.382,7.086-3.701c5.081-3.802,9.343-8.661,11.297-14.813
            c1.076-3.387,2.166-7.955,0.117-11.193c-0.401-0.633-1.247-0.687-1.977-0.487C266.398,217.697,266.634,218.283,266.674,218.954z"
            />
        <path style="fill:#DEDFE0;" d="M268.558,243.605c-1.601,2.179-4.097,3.745-6.351,5.161c-3.166,1.99-6.483,3.737-9.828,5.403
            c-4.477,2.229-9.035,4.341-13.663,6.249c1.89,0.576,3.862,0.827,5.845,0.827c5.008,0,9.997-1.359,14.595-3.272
            c0.306-0.127,0.61-0.264,0.914-0.398c1.141-0.709,2.237-1.481,3.271-2.334c3.49-2.881,6.005-6.522,6.749-11.041
            c0.13-0.79-0.473-1.153-1.116-1.264C268.849,243.172,268.71,243.398,268.558,243.605z"/>
        <path style="fill:#DEDFE0;" d="M259.351,271.173c-3.908,1.316-7.939,2.266-11.978,3.078c-3.814,0.767-7.655,1.395-11.512,1.902
            c-0.769,0.101-1.547,0.206-2.326,0.306c1.449,0.298,2.896,0.603,4.345,0.9c5.072,1.04,10.204,1.986,15.4,1.997
            c1.277,0.003,2.547-0.063,3.806-0.192c1.607-0.753,3.158-1.658,4.693-2.749c3.18-2.26,7.818-5.952,7.598-10.336
            c-0.018-0.356-0.072-0.693-0.157-1.014c-0.327,0.702-0.826,1.328-1.401,1.846C265.481,269.021,262.284,270.185,259.351,271.173z"
            />
        <path style="fill:#DEDFE0;" d="M265.835,289.888c-0.014,0.005-0.026,0.012-0.041,0.017c-2.188,0.773-4.66,0.714-6.937,0.507
            c-2.875-0.261-5.717-0.845-8.512-1.553c-3.052-0.773-6.064-1.708-9.038-2.746c2.777,2.143,5.357,4.543,7.612,7.229
            c2.857,3.403,5.219,7.237,6.702,11.438c0.82,2.323,1.54,4.685,1.647,7.162c0.109,2.512-0.387,5.011-1.363,7.322
            c-0.328,0.776-0.764,1.498-1.241,2.193c5.911-4.589,6.131-15.061,3.496-21.409c-1.09-2.626-2.787-4.965-4.676-7.109
            c3.768,1.197,8.566,2.859,11.803,0.267c0.848-0.679,1.444-1.617,0.919-2.684C266.099,290.303,265.964,290.097,265.835,289.888z"/>
        <path style="fill:#DEDFE0;" d="M173.529,253.241c2.797,0.457,5.682,0.361,8.483-0.003c7.439-0.968,14.682-3.731,21.325-7.139
            c0.572-0.293,1.144-0.599,1.715-0.905c-0.389,0.082-0.775,0.173-1.164,0.252c3.054-2.517,5.604-5.69,6.064-9.645
            c0.01-0.084,0.001-0.171-0.01-0.259c-1.545,1.566-3.213,3.007-4.999,4.303C195.63,246.603,184.274,249.521,173.529,253.241z"/>
        <path style="fill:#DEDFE0;" d="M200.515,229.412c-5.55,2.104-11.312,3.748-16.762,6.118c2.28,0.53,4.624,0.713,6.97,0.622
            c4.818-0.186,9.57-1.376,14.111-2.993c-0.274-0.031-0.545-0.071-0.824-0.087c2.811-1.501,5.569-3.1,8.218-4.859
            c2.88-1.913,5.757-4.041,8.057-6.644c1.739-1.969,3.484-4.509,3.293-7.267c-0.04-0.588-0.322-0.967-0.729-1.17
            c-1.163,2.395-2.783,4.542-4.724,6.393C213.211,224.21,206.783,227.036,200.515,229.412z"/>
        <path style="fill:#DEDFE0;" d="M245.433,171.764c0.167-1.05-0.732-1.326-1.557-1.288c-0.2,2.883-1.791,5.811-3.264,8.111
            c-2.54,3.968-5.711,7.515-8.914,10.953c-3.185,3.418-6.251,6.973-9.545,10.284c-8.845,8.891-19.237,15.93-30.034,22.22
            c2.065-0.14,4.111-0.524,6.114-1.047c4.785-1.25,9.373-3.221,13.749-5.527c-0.758,0.239-1.515,0.479-2.269,0.732
            c2.55-1.793,5.047-3.661,7.476-5.622c5.969-4.819,11.716-9.989,16.633-15.896C239.327,188.07,244.061,180.387,245.433,171.764z"/>
        <path style="fill:#DEDFE0;" d="M254.789,114.603c0.744,1.474,0.403,3.464,0.16,5.015c-0.814,5.205-2.654,10.297-4.495,15.212
            c-1.355,3.62-2.839,7.137-4.603,10.57c-4.941,9.614-10.2,19.078-16.146,28.111c-4.358,6.621-9.096,12.991-14.245,19.014
            c0.509-0.435,1.023-0.863,1.531-1.3c2.22-1.91,4.422-3.845,6.6-5.807c3.835-3.934,7.489-8.048,10.886-12.395
            c4.196-5.369,8.149-10.996,11.333-17.031c2.428-4.601,4.725-9.274,6.924-13.989c2.567-5.505,5.053-11.095,6.944-16.874
            c0.741-2.265,1.422-4.603,1.711-6.975c0.181-1.484,0.235-3.35-0.741-4.598c-1.686-2.154-4.097-1.071-6.164,0.591
            C254.597,114.276,254.699,114.426,254.789,114.603z"/>
        <path style="fill:#DEDFE0;" d="M226.698,30.687c1.482,0.186,2.65,1.36,3.531,2.476c0.775,0.981,1.318,2.101,1.697,3.29
            c0.766,2.399,0.912,4.992,0.877,7.494c-0.039,2.838-0.35,5.666-0.729,8.476c-0.324,2.398-0.732,4.784-1.04,7.184
            c-0.467,3.634-0.769,7.294-1.177,10.936c-1.506,13.44-3.452,26.904-7.296,39.884c0.508-1,1.02-1.999,1.488-3.019
            c0.771-1.681,1.473-3.389,2.147-5.106c0.845-2.847,1.648-5.707,2.364-8.59c2.135-8.603,3.376-17.29,4.554-26.059
            c0.875-6.513,1.676-13.067,1.685-19.648c0.008-5.725-0.098-14.385-5.472-18c-0.934-0.628-2.128-0.12-2.86,0.675
            C226.543,30.682,226.618,30.677,226.698,30.687z"/>
        <g>
            <path style="fill:#F5AF62;" d="M6.47,186.842c3.963-1.068,8.213-1.16,12.295-1.145c3.985,0.014,8.139,2.274,12.044,1.935
                c7.051-0.613,2.309-12.027,0.411-15.084c-1.026-1.652-2.486-3.675-4.261-5.072c-2.732,0.225-5.405,0.961-7.889,2.148
                c-5.058,2.416-9.104,6.364-11.942,11.167c-1.235,2.09-2.325,4.438-2.978,6.874C4.911,187.305,5.724,187.043,6.47,186.842z"/>
            <path style="fill:#F5AF62;" d="M31.219,172.547c-0.335-0.539-0.731-1.117-1.153-1.7c0.439,0.743,0.856,1.494,1.231,2.248
                c1.139,2.295,2.292,5.137,1.666,7.741c-0.797,3.32-4.496,3.798-7.377,3.857c-2.493,0.051-4.974-0.256-7.464-0.323
                c-2.25-0.061-4.419,0.192-6.604,0.719c-1.558,0.376-3.134,0.9-4.572,1.638c3.827-0.953,7.899-1.046,11.819-1.032
                c3.985,0.014,8.139,2.274,12.044,1.935C37.859,187.018,33.117,175.605,31.219,172.547z"/>
            <path style="fill:#F5AF62;" d="M25.389,169.855c-0.013-0.006-0.026-0.012-0.039-0.018c-0.002,0-0.004,0-0.007,0
                c0.003,0.001,0.005,0.002,0.008,0.004C25.339,169.851,25.358,169.854,25.389,169.855z"/>
        </g>
        <path style="fill:#DEDFE0;" d="M129.236,239.218c0,0,22.824,30.301,75.949,5.509C205.186,244.727,160.718,260.074,129.236,239.218
            z"/>
        <path style="fill:#595254;" d="M55.845,166.795c0,2.382-1.931,4.313-4.313,4.313c-2.382,0-4.313-1.931-4.313-4.313
            c0-2.382,1.931-4.313,4.313-4.313C53.914,162.482,55.845,164.413,55.845,166.795z"/>
      `;
      svg.appendChild(doveEl);
      doveX = x;
      doveY = y;
      doveEl.setAttribute('transform', `translate(${x - 10},${y - 10}) scale(0.25)`);
      doveEl.style.opacity = 0;
      setTimeout(() => {
        doveEl.style.transition = 'opacity 0.5s';
        doveEl.style.opacity = 1;
      }, 10);
    } else {
      // 動畫移動到新位置
      const prevX = doveX, prevY = doveY;
      doveX = x; doveY = y;
      doveEl.style.transition = 'transform 0.7s cubic-bezier(.4,2,.6,1)';
      doveEl.setAttribute('transform', `translate(${x - 10},${y - 10}) scale(0.25)`);
    }
  }
}

// 匯出
window.EmotionTree = EmotionTree;
